<div class="grid-card-container card-bottom-margin">
  <form [formGroup]="formgroup" class="grid-form">


    <!-- begin::Academic Year -->
    <div class="form-group">
      <label class="form-label required">Academic Year</label>
      <mat-select class="form-control form-control-sm myPanelClass" formControlName="academicYearCode"
        disableOptionCentering placeholder="Select Academic Year">
        <input type="text" class="form-control  form-control-sm" #filterAcademicYear>
        <div *ngIf="academicYearList | async as postdata ">
          <mat-option *ngFor="let data of postdata | filterData: filterAcademicYear.value : 'academicYear'"
            [value]="data.academicYearCode">
            {{data.academicYear}}
          </mat-option>
        </div>
      </mat-select>
      <div class="invalid-feedback">
        {{validationMsg.getErrorMessage(formControll.academicYearCode,"Academic Year")}}
      </div>
    </div>
    <!-- end::Academic Year -->


    <!-- begin::Class Name -->
    <div class="form-group">
      <label class="form-label required">Class / Standard</label>
      <mat-select class="form-control form-control-sm myPanelClass" formControlName="classCode" disableOptionCentering
        placeholder="Select Enrollment Type">
        <input type="text" class="form-control  form-control-sm" #filterClassName>
        <div *ngIf="allClassList | async as postdata ">
          <mat-option *ngFor="let data of postdata | filterData: filterClassName.value : 'className'"
            [value]="data.classCode">
            {{data.className}}
          </mat-option>
        </div>
      </mat-select>
      <div class="invalid-feedback">
        {{validationMsg.getErrorMessage(formControll.classCode,"Class")}}
      </div>
    </div>
    <!-- end::Class Name -->

    <!-- begin::Enrollment Type -->
    <!-- <div class="form-group">
            <label class="form-label required">Select Enrollment Type</label>
            <mat-select formControlName="enrollmentType" disableOptionCentering  placeholder="Select Enrollment Type" class="form-control form-control-sm myPanelClass">
                    <mat-option value="new">New Student</mat-option>
                    <mat-option value="enrolled">Already Enrolled</mat-option>
            </mat-select>
            <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.enrollmentType,"Enrollment Type")}}</div>
          </div> -->
    <!-- end::Enrollment Type -->




    <!-- begin::Payment Type -->
    <!-- <div class="form-group">
            <label class="form-label required">Payment Type</label>
            <mat-select formControlName="paymentType" disableOptionCentering  placeholder="Select Payment Type" class="form-control form-control-sm myPanelClass">
                    <mat-option value="Instalment">Instalment</mat-option>
                    <mat-option value="Lumpsum">Lumpsum</mat-option>
            </mat-select>
            <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.paymentType,"Payment Type")}}</div>
        </div> -->
    <!-- end:: Payment Type -->

    <!-- begin::Validiti Start Date -->
    <!-- <div class="form-group">
            <label class="form-label required">Validity Start Date</label>
            <input class="form-control form-control-sm" formControlName="validityStartDate" placeholder="Start Date" autocomplete="off">
            <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.validityStartDate,"Validity Start Date")}}</div>
        </div> -->
    <!-- end:: Validity Start Date-->

    <!-- begin::Validity End Date -->
    <!-- <div class="form-group">
            <label class="form-label required">Validity End Date</label>
            <input class="form-control form-control-sm" formControlName="validityEndDate" placeholder="End Date" autocomplete="off">
            <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.validityEndDate,"Validity End Date")}}</div>
        </div> -->
    <!-- end:: Validity End Date-->

    <!-- begin::Remarks-->
    <!-- <div class="form-group">
            <label class="form-label">Remarks</label>
            <input class="form-control form-control-sm" formControlName="remarks" placeholder="Enter Remarks" autocomplete="off">
            <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.remarks,"Remarks")}}</div>
        </div> -->
    <!-- end:: Remarks -->

    <!-- begin::Total Fees-->
    <div class="form-group">
      <label class="form-label required">Total Fees</label>
      <input class="form-control form-control-sm" (input)="totalFeesChange()" formControlName="totalFees"
        placeholder="Enter Total Fees" autocomplete="off">
      <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.totalFees,"Total Fees")}}</div>
    </div>
    <!-- end:: Remarks -->

    <!-- begin::Discount-->
    <div class="form-group">
      <label class="form-label">Select Discount Reason</label>
      <mat-select class="form-control form-control-sm myPanelClass" formControlName="discountReasonCode"
        placeholder="Select Discount Reason" disableOptionCentering>
        <input type="text" class="form-control  form-control-sm" #filterDiscountReason>
        <div *ngIf="discountReasonList | async as postdata ">
          <mat-option *ngFor="let data of postdata | filterData: filterDiscountReason.value : 'discountReason'"
            [value]="data.discountReasonCode">
            {{data.discountReason}}
          </mat-option>
        </div>
      </mat-select>
      <div class="invalid-feedback">
        {{validationMsg.getErrorMessage(formControll.discountReasonCode,"Discount Reason")}}
      </div>
    </div>
    <!-- end:: Discount -->

    <!-- begin::Discount Amount-->
    <div class="form-group">
      <label class="form-label">Discount Amount</label>
      <input class="form-control form-control-sm" formControlName="discountAmount" (input)="totalFeesChange()"
        placeholder="Enter Discount Amount" autocomplete="off">
      <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.discountAmount,"")}}</div>
    </div>
    <!-- end:: Discount Amount -->

    <!-- begin::Net Amount-->
    <div class="form-group">
      <label class="form-label required">Net Amount (After Discount)</label>
      <input class="form-control form-control-sm" readonly formControlName="netAmountAfterDiscount"
        placeholder="Enter Net Amount" autocomplete="off">
      <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.netAmountAfterDiscount,"")}}</div>
    </div>
    <!-- end:: Net Amount -->

    <!-- begin::Registration Fees-->
    <div class="form-group">
      <label class="form-label required">Registration Fees</label>
      <input class="form-control form-control-sm" formControlName="registrationFees" (input)="totalFeesChange()"
        placeholder="Enter Registration Fees" autocomplete="off">
      <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.registrationFees,"Resgistration
        Fees")}}</div>
    </div>
    <!-- end::Registration Fees -->

    <!-- begin::Annual Fees-->
    <div class="form-group">
      <label class="form-label required">Annual Fees</label>
      <input class="form-control form-control-sm" formControlName="annualFees" (input)="totalFeesChange()"
        placeholder="Enter Annual Fees" autocomplete="off">
      <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.annualFees,"Annual Fees")}}</div>
    </div>
    <!-- end::Annual Fees -->

    <!-- begin::Annual Fees Date-->
    <div class="form-group">
      <div class="datepicker-container">
        <label class="form-label required">Annual Fees Date</label>
        <input matInput [matDatepicker]="picker" formControlName="annualFeesDate" class="form-control form-control-sm"
          readonly>
        <mat-datepicker-toggle matSuffix [for]="picker" class="toggle-datepicker-icon-position"
          [disabled]="false"></mat-datepicker-toggle>
        <mat-datepicker #picker [disabled]="false"></mat-datepicker>
        <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.annualFeesDate,"Annual Fees Date")}}
        </div>
      </div>
    </div>
    <!-- end::Annual Fees Date-->

    <!-- begin::Lumsum Amount-->
    <!-- <div class="form-group">
      <label class="form-label">Lumsum Amount</label> -->
    <input type="hidden" class="form-control form-control-sm" readonly formControlName="lumpsumAmount">
    <!-- <div class="invalid-feedback">{{validationMsg.getErrorMessage(formControll.lumpsumAmount,"")}}</div>
    </div> -->
    <!-- end::Lumsum Amount -->

    <button class="btn btn-sm btn-primary" (click)="addInstallment()">Add Installment</button>
    <div>
        <div class="installment-amount-colour">Term Fees ( {{totalInstallmentAmount}} Rs )</div>
    </div>
    <div></div>

    <ng-container formArrayName="installment">
      <ng-container *ngFor="let installmentFormGroup of installmentFormGroups.controls; let i = index">
        <ng-container [formGroupName]="i">
          <!-- begin::1 Installment Number-->
          <div class="form-group">
            <input type="text" readonly formControlName="installmentNumber" class="form-control form-control-sm">
          </div>
          <!-- end::Annual Installment Number-->

          <!-- begin installment Date -->
          <div class="form-group">
            <div class="datepicker-container">
              <input matInput [matDatepicker]="picker" formControlName="installmentDate"
                class="form-control form-control-sm" readonly>
              <mat-datepicker-toggle matSuffix [for]="picker" class="toggle-datepicker-icon-position"
                [disabled]="false"></mat-datepicker-toggle>
              <mat-datepicker #picker [disabled]="false"></mat-datepicker>
            </div>
          </div>
          <!--end::installment Date-->

          <!-- begin:: 1 Installment Amount-->
          <div class="form-group display-flex">
            <input type="number" formControlName="installmentAmount" (input)="installmentAmountChange()"
              class="form-control form-control-sm">
            <button class="btn btn-sm btn-danger ml-3 sm btn-height" (click)="removeInstallment(i)">Remove</button>
          </div>
          <!-- end::Annual Installment Amount-->
        </ng-container>
      </ng-container>
    </ng-container>


 <!--Begin:: Sum of installment -->
 <ng-container *ngIf="installmentFlag">
  <div class="grid-button installment-matched">
    <h4>Installment Matches Total Term Fees You Can Proceed Now!!</h4>
  </div>
</ng-container>

<!-- End:: Sum of installment -->


    <!-- begin::Buttons -->
    <div class="grid-button form-group ">
      <ng-container *ngIf="actionFlag">
        <button class="btn btn-sm btn-success mx-3" [disabled]="!formgroup.valid || !editable || !installmentFlag"
          (click)="save()">Save</button>
        <!-- <button class="btn btn-sm btn-success mx-3" (click)="save()">Save</button> -->
      </ng-container>
      <ng-container *ngIf="!actionFlag">
        <button class="btn btn-sm btn-success mx-3" [disabled]="!formgroup.valid || !editable"
          (click)="update()">Update</button>
      </ng-container>

      <button class="btn btn-sm btn-danger" (click)="resetForm()">Reset</button>
    </div>
    <!-- end::Buttons -->

  </form>
</div>

<!--begin::second Card body-->
<ng-container *ngIf="posts | async as postData ">
  <div class="grid-card-container card-bottom-padding pt-2" *ngIf="postData.data ">
    <!--end::table-->
    <table id='table' datatable [dtOptions]="dtOptions" class="custom-data-table">
      <thead>
        <tr>
          <th>S.No.</th>
          <th>Class</th>
          <!-- <th>Fees Type Code</th> -->
          <th>Academic Year</th>
          <th>Enrollment Type</th>

          <th>Payment Type</th>
          <th>Validity Srart Date</th>
          <th>Validity End Date</th>
          <th>Total Fees</th>
          <th>Discount Reason</th>
          <th>Net Amount After Discount</th>
          <th>Registration Fees</th>
          <th>Annual Fees</th>
          <th>Annual Fees Date</th>
          <th>Remark</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let post of postData.data ; let i=index">
          <td class="td-sno">{{i+1}}</td>
          <td class="td-large">{{ post.classCode }}</td>
          <td class="td-auto">{{ post.academicYearCode }}</td>
          <td class="td-large">{{ post.enrollmentType }}</td>
          <td class="td-large">{{ post.paymentType }}</td>
          <td class="td-large">{{ post.validityStartDate }}</td>
          <td class="td-large">{{ post.validityEndDate }}</td>
          <td class="td-large">{{ post.totalFees }}</td>
          <td class="td-large">{{ post.discountReasonCode }}</td>
          <td class="td-large">{{ post.netAmountAfterDiscount }}</td>
          <td class="td-large">{{ post.registrationFees }}</td>
          <td class="td-large">{{ post.annualFees }}</td>
          <td class="td-large">{{ post.annualFeesDate }}</td>
          <td class="td-large">{{ post.remarks }}</td>
          <td class="td-status">
            <mat-slide-toggle [checked]="post.active" (change)="slideToggleChange($event, post)">
            </mat-slide-toggle>
          </td>
          <td class="td-action">
            <a (click)="setValueToUpdate(post)"><i class="fa fa-pencil-square-o fa-lg"></i></a>
          </td>
        </tr>
      </tbody>
    </table>
    <!--end::table-->
  </div>
</ng-container>
<!--end::second Card body-->